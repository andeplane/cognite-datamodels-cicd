name: Deploy transformations
on:
  push:
    branches:
      - main
jobs:
  publish-dm:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v3
      - name: Load version
        run: |
          VERSION=$(cat VERSION)
          echo "VERSION=$VERSION" >> $GITHUB_ENV
      - name: Deploy transformations
        uses: cognitedata/transformations-cli@main
        env:
            # Credentials to be used when running your transformations,
            # as referenced in your manifests:
            COGNITE_CLIENT_ID: ${{ env.CLI_CLIENT_ID }}
            COGNITE_CLIENT_SECRET: ${{ secrets.CLI_CLIENT_SECRET }}
            CLI_CLIENT_ID: ${{ env.CLI_CLIENT_ID }}
            CLI_CLIENT_SECRET: ${{ secrets.CLI_CLIENT_SECRET }}
            CLI_PROJECT: ${{ env.CLI_PROJECT }}
            VERSION: ${{ env.VERSION }}
        with:
            # Credentials used for deployment
            path: transformations  # Transformation manifest folder, relative to GITHUB_WORKSPACE
            client-id: ${{ env.CLI_CLIENT_ID }}
            client-secret: ${{ secrets.CLI_CLIENT_SECRET }}
            token-url: https://login.microsoftonline.com/${{env.CLI_TENANT}}/oauth2/v2.0/token
            cdf-project-name: andershaf
            # If you need to provide multiple scopes, the format: "scope1 scope2 scope3"
            scopes: https://api.cognitedata.com/.default
            # audience: "" # Optional